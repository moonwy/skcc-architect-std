#!/usr/bin/env python3
"""
AI ì½”ë“œ ë¦¬ë·° & ìµœì í™” Agent ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
"""

import os
import sys
import subprocess
import logging

def check_requirements():
    """í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ í™•ì¸"""
    try:
        import streamlit
        import langchain
        import langgraph
        import faiss
        import openai
        print("âœ… ëª¨ë“  í•„ìˆ˜ íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.")
        return True
    except ImportError as e:
        print(f"âŒ í•„ìˆ˜ íŒ¨í‚¤ì§€ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤: {e}")
        print("ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”:")
        print("pip install -r requirements.txt")
        return False

def check_env_variables():
    """í™˜ê²½ë³€ìˆ˜ í™•ì¸"""
    required_vars = [
        "AZURE_OPENAI_API_KEY",
        "AZURE_OPENAI_ENDPOINT", 
        "AZURE_OPENAI_DEPLOYMENT_NAME"
    ]
    
    missing_vars = []
    for var in required_vars:
        if not os.getenv(var):
            missing_vars.append(var)
    
    if missing_vars:
        print("âŒ ë‹¤ìŒ í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤:")
        for var in missing_vars:
            print(f"  - {var}")
        print("\n.env íŒŒì¼ì„ ìƒì„±í•˜ê³  í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”.")
        return False
    
    print("âœ… í™˜ê²½ë³€ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.")
    return True

def create_directories():
    """í•„ìš”í•œ ë””ë ‰í† ë¦¬ ìƒì„±"""
    directories = [
        "data",
        "data/vector_db",
        "data/knowledge_base"
    ]
    
    for directory in directories:
        os.makedirs(directory, exist_ok=True)
    
    print("âœ… í•„ìš”í•œ ë””ë ‰í† ë¦¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")

def run_streamlit():
    """Streamlit ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰"""
    try:
        print("ğŸš€ AI ì½”ë“œ ë¦¬ë·° Agentë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...")
        print("ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8501 ë¡œ ì ‘ì†í•˜ì„¸ìš”.")
        print("ì¢…ë£Œí•˜ë ¤ë©´ Ctrl+Cë¥¼ ëˆ„ë¥´ì„¸ìš”.")
        
        subprocess.run([
            sys.executable, "-m", "streamlit", "run", "app.py",
            "--server.port", "8501",
            "--server.address", "localhost"
        ])
    except KeyboardInterrupt:
        print("\nğŸ‘‹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
    except Exception as e:
        print(f"âŒ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    print("=" * 50)
    print("ğŸ” AI ì½”ë“œ ë¦¬ë·° & ìµœì í™” Agent")
    print("=" * 50)
    
    # 1. íŒ¨í‚¤ì§€ í™•ì¸
    if not check_requirements():
        sys.exit(1)
    
    # 2. í™˜ê²½ë³€ìˆ˜ í™•ì¸
    if not check_env_variables():
        sys.exit(1)
    
    # 3. ë””ë ‰í† ë¦¬ ìƒì„±
    create_directories()
    
    # 4. Streamlit ì‹¤í–‰
    run_streamlit()

if __name__ == "__main__":
    main() 